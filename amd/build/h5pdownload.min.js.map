{"version":3,"sources":["../src/h5pdownload.js"],"names":["define","$","Url","Str","bgColor","txtColor","titleTxt","licenceToUse","downloadText","copyText","closeText","licenceIntro","licenceTarget","licenceName","licenceShortname","licenceUrl","reuseConditions","modHVPexport","init","cfg","self","get_string","done","str","backgroundColor","textColor","isHVP","hvpobject","window","H5PIntegration","hvpcontents","Object","values","exportUrl","$h5ps","each","index","hoverElement","element","on","src","find","attr","length","h5pUrlPart","split","downloadLink","decodeURIComponent","$openOverlay","append","addImage","createOverlay","fadeIn","prepend","fadeOut","$closeOverlay","html","remove","ccDiv","ccHref","$cc","data","$ccImage","$copy","navigator","clipboard","writeText","$column1Html1","$licenceArea","class","style","$column1Html2","column2Html","text","title","href","$content","$column1","$column2","$modal","$overlay","img","className","icon","imageUrl"],"mappings":"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","sourcesContent":["define(['jquery', 'core/url', 'core/str'], function($, Url, Str) {\n    let bgColor = '',\n        txtColor = '',\n        titleTxt = '',\n        licenceToUse = '',\n        downloadText = 'Download',\n        copyText = 'Copy',\n        closeText = 'Close',\n        licenceIntro = '',\n        licenceTarget = '',\n        licenceName = '',\n        licenceShortname = '',\n        licenceUrl = '',\n        reuseConditions = '',\n        modHVPexport = '';\n\n    return {\n        init: function(cfg) {\n            const self = this;\n\n            // Set variables.\n            Str.get_string('content_reuse', 'filter_h5pdownload').done((str) => titleTxt = '<h4>' + str + '</h4>');\n            Str.get_string('licence_to_use', 'filter_h5pdownload').done((str) => licenceToUse = str);\n            Str.get_string('download', 'core').done((str) => downloadText = str);\n            Str.get_string('copy', 'core').done((str) => copyText = str);\n            Str.get_string('close', 'core').done((str) => closeText = str);\n\n            bgColor = cfg.backgroundColor;\n            txtColor = cfg.textColor;\n            licenceIntro = cfg.licenceIntro;\n            licenceTarget = cfg.licenceTarget;\n            licenceName = cfg.licenceName;\n            licenceShortname = cfg.licenceShortname;\n            licenceUrl = cfg.licenceUrl;\n            reuseConditions = cfg.reuseConditions;\n\n            // If the activity is mod_hvp\n            if (cfg.isHVP) {\n                const hvpobject = window.H5PIntegration;\n                const hvpcontents = Object.values(hvpobject['contents'])[0]\n                const exportUrl = hvpcontents['exportUrl'];\n                if (exportUrl) {\n                    modHVPexport = exportUrl;\n                }\n            }\n\n            // Get the H5P DOM elements.\n            $h5ps = $('.h5p-placeholder, .h5p-iframe-wrapper');\n            $h5ps.each(function(index) {\n                self.hoverElement($($h5ps[index]));\n            });\n        },\n\n        hoverElement: function(element) {\n            const self = this;\n            element.on(\"mouseenter\", function() {\n                const src = element.find(\".h5p-iframe\").attr(\"src\");\n                if (src.length > 0 && src != 'about:blank') {\n                    const h5pUrlPart = src.split(\"embed.php?url=\")[1].split(\".h5p\")[0];\n\n                    if (h5pUrlPart.length > 0) {\n                        const downloadLink = decodeURIComponent(h5pUrlPart) + \".h5p\";\n\n                        $openOverlay = $('<button class=\"h5p-download\">').append(self.addImage('download', downloadText, 'icon'));\n                        $openOverlay.on('click', function() {\n                            self.createOverlay(downloadLink);\n                        });\n\n                        if (!element.find(\".h5p-download\").length) {\n                            element.append($openOverlay);\n                        }\n\n                        element.find(\".h5p-download\").fadeIn();\n                    }\n                } else if (modHVPexport != '') {\n                    $openOverlay = $('<button class=\"h5p-download\">').append(self.addImage('download', downloadText, 'icon'));\n                    $openOverlay.on('click', function() {\n                        self.createOverlay(modHVPexport);\n                    });\n\n                    if (!element.find(\".h5p-download\").length) {\n                        element.prepend($openOverlay);\n                    }\n\n                    element.find(\".h5p-download\").fadeIn();\n                }\n            });\n\n            element.on(\"mouseleave\", function() {\n                element.find(\".h5p-download\").fadeOut();\n            });\n        },\n\n        createOverlay: function(downloadLink) {\n            $closeOverlay = $('<div class=\"close-modal\"></div>')\n                .html(this.addImage('times', closeText, 'icon'));\n            $closeOverlay.on('click', function() {\n                $('body').find('.download-overlay').remove();\n            });\n\n            const ccDiv = $('<div/>');\n            ccDiv.attr('class', 'mt-2');\n\n            const ccHref = $('<a/>');\n            ccHref.attr('target', \"_blank\");\n\n            if (licenceTarget) {\n                // Get the CC Licence if provided.\n                $cc = $('#' + licenceTarget);\n                if ($cc && $cc.attr('href')) {\n                    // Get the licence name.\n                    licenceName = $cc.data('name');\n                    ccHref.attr('href', $cc.attr('href'));\n                    // Get the licence image.\n                    $ccImage = $cc.find('img');\n                    if ($ccImage) {\n                        ccHref.append(this.addImage('cc/cc', 'CC image', 'licence-image', $ccImage.attr('src')));\n                    }\n                }\n            } else {\n                // Use the filter settings values.\n                ccHref.attr('href', licenceUrl);\n                ccHref.append(this.addImage('cc/cc', 'CC image', 'modal-icon'));\n                ccHref.append(this.addImage('cc/by', 'BY image', 'modal-icon'));\n                ccHref.append(this.addImage('cc/nc', 'NC image', 'modal-icon'));\n            }\n\n            // Append the CC link to the div.\n            ccDiv.append(ccHref);\n\n            $copy = $('<button class=\"btn\"></button>')\n                .on('click', function() { navigator.clipboard.writeText(licenceShortname) })\n                .prepend(this.addImage('copy', copyText, 'icon'));\n\n            let $column1Html1 = $('<p>', {\n                html: licenceIntro + ' <a href=\"'+ licenceUrl +'\" target=\"_blank\">' + licenceName + '</a>.'\n            }).append(ccDiv);\n\n            let $licenceArea = $('<div>', {\n                class: \"licence\",\n                style: \"background-color:\"+ bgColor +\";color:\"+ txtColor,\n                html: '<span>' + licenceToUse + ' : ' + licenceShortname + '</span>'\n            }).append($copy);\n        \n            let $column1Html2 = $('<p>', {\n                html: '<p>' + reuseConditions + '</p>'\n            }).append($licenceArea);\n\n            let column2Html = $('<a>', {\n                text: downloadText,\n                title: downloadText,\n                class: 'btn btn-secondary',\n                href: downloadLink\n            }).prepend(this.addImage('download', downloadText, 'icon'));\n\n            $content = $('<div/>');\n            $content.attr('class', 'content');\n\n            $column1 = $('<div/>');\n            $column1.attr('class', 'column');\n            $column1.html($column1Html1).append($column1Html2);\n\n            $column2 = $('<div/>');\n            $column2.attr('class', 'column');\n            $column2.html(column2Html);\n\n            $content.append($column1);\n            $content.append($column2);\n\n            $modal = $('<div class=\"download-modal\">').html(titleTxt).append($content).append($closeOverlay);\n            $overlay = $('<div class=\"download-overlay\">').append($modal);\n\n            $('body').append($overlay);\n        },\n\n        addImage: function(img, title, className, src=null) {\n            const icon = $('<img/>');\n            icon.attr('alt', title);\n            icon.attr('title', title);\n            icon.attr('class', className);\n            icon.attr('src', src);\n            if (!src) {\n                icon.attr('src', Url.imageUrl(img, 'filter_h5pdownload'));\n            }\n            return icon;\n        }\n    };\n});\n"],"file":"h5pdownload.min.js"}