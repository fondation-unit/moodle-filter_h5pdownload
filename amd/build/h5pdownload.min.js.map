{"version":3,"sources":["../src/h5pdownload.js"],"names":["define","$","Url","Str","bgColor","txtColor","titleTxt","licenceToUse","downloadText","copyText","closeText","licenceIntro","licenceName","licenceShortname","licenceUrl","reuseConditions","modHVPexport","init","cfg","self","get_string","done","str","backgroundColor","textColor","isHVP","hvpobject","window","H5PIntegration","hvpcontents","Object","values","exportUrl","$h5ps","each","index","hoverElement","element","on","src","find","attr","length","h5pUrlPart","split","downloadLink","decodeURIComponent","$openOverlay","append","addImage","createOverlay","fadeIn","prepend","fadeOut","$closeOverlay","html","remove","$cc","ccDiv","ccHref","$ccImage","$copy","navigator","clipboard","writeText","$column1Html1","$licenceArea","class","style","$column1Html2","column2Html","text","title","href","$content","$column1","$column2","$modal","$overlay","img","className","icon","imageUrl"],"mappings":"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","sourcesContent":["define(['jquery', 'core/url', 'core/str'], function($, Url, Str) {\n    let bgColor = '',\n        txtColor = '',\n        titleTxt = '',\n        licenceToUse = '',\n        downloadText = 'Download',\n        copyText = 'Copy',\n        closeText = 'Close',\n        licenceIntro = '',\n        licenceName = '',\n        licenceShortname = '',\n        licenceUrl = '',\n        reuseConditions = '',\n        modHVPexport = '';\n\n    return {\n        init: function(cfg) {\n            const self = this;\n\n            // Set variables.\n            Str.get_string('content_reuse', 'filter_h5pdownload').done((str) => titleTxt = '<h4>' + str + '</h4>');\n            Str.get_string('licence_to_use', 'filter_h5pdownload').done((str) => licenceToUse = str);\n            Str.get_string('download', 'core').done((str) => downloadText = str);\n            Str.get_string('copy', 'core').done((str) => copyText = str);\n            Str.get_string('close', 'core').done((str) => closeText = str);\n\n            bgColor = cfg.backgroundColor;\n            txtColor = cfg.textColor;\n            licenceIntro = cfg.licenceIntro;\n            licenceName = cfg.licenceName;\n            licenceShortname = cfg.licenceShortname;\n            licenceUrl = cfg.licenceUrl;\n            reuseConditions = cfg.reuseConditions;\n\n            // If the activity is mod_hvp\n            if (cfg.isHVP) {\n                const hvpobject = window.H5PIntegration;\n                const hvpcontents = Object.values(hvpobject['contents'])[0]\n                const exportUrl = hvpcontents['exportUrl'];\n                if (exportUrl) {\n                    modHVPexport = exportUrl;\n                }\n            }\n\n            // Get the H5P DOM elements.\n            $h5ps = $('.h5p-placeholder, .h5p-iframe-wrapper');\n            $h5ps.each(function(index) {\n                self.hoverElement($($h5ps[index]));\n            });\n        },\n\n        hoverElement: function(element) {\n            const self = this;\n            element.on(\"mouseenter\", function() {\n                const src = element.find(\".h5p-iframe\").attr(\"src\");\n                if (src.length > 0 && src != 'about:blank') {\n                    const h5pUrlPart = src.split(\"embed.php?url=\")[1].split(\".h5p\")[0];\n\n                    if (h5pUrlPart.length > 0) {\n                        const downloadLink = decodeURIComponent(h5pUrlPart) + \".h5p\";\n\n                        $openOverlay = $('<button class=\"h5p-download\">').append(self.addImage('download', downloadText, 'icon'));\n                        $openOverlay.on('click', function() {\n                            self.createOverlay(downloadLink);\n                        });\n\n                        if (!element.find(\".h5p-download\").length) {\n                            element.append($openOverlay);\n                        }\n\n                        element.find(\".h5p-download\").fadeIn();\n                    }\n                } else if (modHVPexport != '') {\n                    $openOverlay = $('<button class=\"h5p-download\">').append(self.addImage('download', downloadText, 'icon'));\n                    $openOverlay.on('click', function() {\n                        self.createOverlay(modHVPexport);\n                    });\n\n                    if (!element.find(\".h5p-download\").length) {\n                        element.prepend($openOverlay);\n                    }\n\n                    element.find(\".h5p-download\").fadeIn();\n                }\n            });\n\n            element.on(\"mouseleave\", function() {\n                element.find(\".h5p-download\").fadeOut();\n            });\n        },\n\n        createOverlay: function(downloadLink) {\n            $closeOverlay = $('<div class=\"close-modal\"></div>')\n                .html(this.addImage('times', closeText, 'icon'));\n            $closeOverlay.on('click', function() {\n                $('body').find('.download-overlay').remove();\n            });\n\n            // Get the CC Licence if provided.\n            $cc = $('#cc-licence');\n\n            const ccDiv = $('<div/>');\n            ccDiv.attr('class', 'mt-2');\n\n            const ccHref = $('<a/>');\n            ccHref.attr('target', \"_blank\");\n\n            if ($cc && $cc.attr('href')) {\n                ccHref.attr('href', $cc.attr('href'));\n                $ccImage = $cc.find('img');\n                if ($ccImage) {\n                    ccHref.append(this.addImage('cc/cc', 'CC image', 'modal-icon', $ccImage.attr('src')));\n                }\n            } else {\n                ccHref.attr('href', licenceUrl);\n                ccHref.append(this.addImage('cc/cc', 'CC image', 'modal-icon'));\n                ccHref.append(this.addImage('cc/by', 'BY image', 'modal-icon'));\n                ccHref.append(this.addImage('cc/nc', 'NC image', 'modal-icon'));\n            }\n\n            // Append the CC link to the div.\n            ccDiv.append(ccHref);\n\n            $copy = $('<button class=\"btn\"></button>')\n                .on('click', function() { navigator.clipboard.writeText(licenceShortname) })\n                .prepend(this.addImage('copy', copyText, 'icon'));\n\n            let $column1Html1 = $('<p>', {\n                html: licenceIntro + ' <a href=\"'+ licenceUrl +'\" target=\"_blank\">' + licenceName + '</a>.'\n            }).append(ccDiv);\n\n            let $licenceArea = $('<div>', {\n                class: \"licence\",\n                style: \"background-color:\"+ bgColor +\";color:\"+ txtColor,\n                html: '<span>' + licenceToUse + ' : ' + licenceShortname + '</span>'\n            }).append($copy);\n        \n            let $column1Html2 = $('<p>', {\n                html: '<p>' + reuseConditions + '</p>'\n            }).append($licenceArea);\n\n            let column2Html = $('<a>', {\n                text: downloadText,\n                title: downloadText,\n                class: 'btn btn-secondary',\n                href: downloadLink\n            }).prepend(this.addImage('download', downloadText, 'icon'));\n\n            $content = $('<div/>');\n            $content.attr('class', 'content');\n\n            $column1 = $('<div/>');\n            $column1.attr('class', 'column');\n            $column1.html($column1Html1).append($column1Html2);\n\n            $column2 = $('<div/>');\n            $column2.attr('class', 'column');\n            $column2.html(column2Html);\n\n            $content.append($column1);\n            $content.append($column2);\n\n            $modal = $('<div class=\"download-modal\">').html(titleTxt).append($content).append($closeOverlay);\n            $overlay = $('<div class=\"download-overlay\">').append($modal);\n\n            $('body').append($overlay);\n        },\n\n        addImage: function(img, title, className, src=null) {\n            const icon = $('<img/>');\n            icon.attr('alt', title);\n            icon.attr('title', title);\n            icon.attr('class', className);\n            icon.attr('src', src);\n            if (!src) {\n                icon.attr('src', Url.imageUrl(img, 'filter_h5pdownload'));\n            }\n            return icon;\n        }\n    };\n});\n"],"file":"h5pdownload.min.js"}