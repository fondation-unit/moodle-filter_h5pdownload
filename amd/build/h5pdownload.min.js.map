{"version":3,"sources":["../src/h5pdownload.js"],"names":["define","$","Url","Str","bgColor","txtColor","titleTxt","licenceToUse","downloadText","copyText","closeText","licenceIntro","licenceName","licenceShortname","licenceUrl","reuseConditions","init","cfg","self","get_string","done","str","backgroundColor","textColor","$h5ps","each","index","hoverElement","element","on","src","find","attr","h5pUrlPart","split","length","downloadLink","decodeURIComponent","$openOverlay","append","addImage","createOverlay","fadeIn","fadeOut","$closeOverlay","html","remove","ccDiv","ccHref","$copy","navigator","clipboard","writeText","prepend","$column1Html1","$licenceArea","class","style","$column1Html2","column2Html","text","title","href","$content","$column1","$column2","$modal","$overlay","img","className","icon","imageUrl"],"mappings":"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","sourcesContent":["define(['jquery', 'core/url', 'core/str'], function($, Url, Str) {\n    let bgColor = '',\n        txtColor = '',\n        titleTxt = '',\n        licenceToUse = '',\n        downloadText = 'Download',\n        copyText = 'Copy',\n        closeText = 'Close',\n        licenceIntro = '',\n        licenceName = '',\n        licenceShortname = '',\n        licenceUrl = '',\n        reuseConditions = '';\n\n    return {\n        init: function(cfg) {\n            const self = this;\n\n            // Set variables.\n            Str.get_string('content_reuse', 'filter_h5pdownload').done((str) => titleTxt = '<h4>' + str + '</h4>');\n            Str.get_string('licence_to_use', 'filter_h5pdownload').done((str) => licenceToUse = str);\n            Str.get_string('download', 'core').done((str) => downloadText = str);\n            Str.get_string('copy', 'core').done((str) => copyText = str);\n            Str.get_string('close', 'core').done((str) => closeText = str);\n\n            bgColor = cfg.backgroundColor;\n            txtColor = cfg.textColor;\n            licenceIntro = cfg.licenceIntro;\n            licenceName = cfg.licenceName;\n            licenceShortname = cfg.licenceShortname;\n            licenceUrl = cfg.licenceUrl;\n            reuseConditions = cfg.reuseConditions;\n\n            // Get the H5P DOM elements.\n            $h5ps = $('.h5p-placeholder, .h5p-iframe-wrapper');\n            $h5ps.each(function(index) {\n                self.hoverElement($($h5ps[index]));\n            });\n        },\n\n        hoverElement: function(element) {\n            const self = this;\n            element.on(\"mouseenter\", function() {\n                const src = element.find(\".h5p-iframe\").attr(\"src\");\n                const h5pUrlPart = src.split(\"embed.php?url=\")[1].split(\".h5p\")[0];\n\n                if (h5pUrlPart.length > 0) {\n                    const downloadLink = decodeURIComponent(h5pUrlPart) + \".h5p\";\n\n                    $openOverlay = $('<button class=\"h5p-download\">').append(self.addImage('download', downloadText, 'icon'));\n                    $openOverlay.on('click', function() {\n                        self.createOverlay(downloadLink);\n                    });\n\n                    if (!element.find(\".h5p-download\").length) {\n                        element.append($openOverlay);\n                    }\n\n                    element.find(\".h5p-download\").fadeIn();\n                }\n            });\n\n            element.on(\"mouseleave\", function() {\n                element.find(\".h5p-download\").fadeOut();\n            });\n        },\n\n        createOverlay: function(downloadLink) {\n            $closeOverlay = $('<div class=\"close-modal\"></div>')\n                .html(this.addImage('times', closeText, 'icon'));\n            $closeOverlay.on('click', function() {\n                $('body').find('.download-overlay').remove();\n            });\n\n            const ccDiv = $('<div/>');\n            ccDiv.attr('class', 'mt-2');\n\n            const ccHref = $('<a/>');\n            ccHref.attr('href', licenceUrl);\n            ccHref.attr('target', \"_blank\");\n\n            ccHref.append(this.addImage('cc/cc', 'CC image', 'modal-icon'));\n            ccHref.append(this.addImage('cc/by', 'BY image', 'modal-icon'));\n            ccHref.append(this.addImage('cc/nc', 'NC image', 'modal-icon'));\n            ccDiv.append(ccHref);\n\n\n            $copy = $('<button class=\"btn\"></button>')\n                .on('click', function() { navigator.clipboard.writeText(licenceShortname) })\n                .prepend(this.addImage('copy', copyText, 'icon'));\n\n            let $column1Html1 = $('<p>', {\n                html: licenceIntro + ' <a href=\"'+ licenceUrl +'\" target=\"_blank\">' + licenceName + '</a>.'\n            }).append(ccDiv);\n\n            let $licenceArea = $('<div>', {\n                class: \"licence\",\n                style: \"background-color:\"+ bgColor +\";color:\"+ txtColor,\n                html: '<span>' + licenceToUse + ' : ' + licenceShortname + '</span>'\n            }).append($copy);\n        \n            let $column1Html2 = $('<p>', {\n                html: '<p>' + reuseConditions + '</p>'\n            }).append($licenceArea);\n\n            let column2Html = $('<a>', {\n                text: downloadText,\n                title: downloadText,\n                class: 'btn btn-secondary',\n                href: downloadLink\n            }).prepend(this.addImage('download', downloadText, 'icon'));\n\n            $content = $('<div/>');\n            $content.attr('class', 'content');\n\n            $column1 = $('<div/>');\n            $column1.attr('class', 'column');\n            $column1.html($column1Html1).append($column1Html2);\n\n            $column2 = $('<div/>');\n            $column2.attr('class', 'column');\n            $column2.html(column2Html);\n\n            $content.append($column1);\n            $content.append($column2);\n\n            $modal = $('<div class=\"download-modal\">').html(titleTxt).append($content).append($closeOverlay);\n            $overlay = $('<div class=\"download-overlay\">').append($modal);\n\n            $('body').append($overlay);\n        },\n\n        addImage: function(img, title, className) {\n            const icon = $('<img/>');\n            icon.attr('alt', title);\n            icon.attr('title', title);\n            icon.attr('class', className);\n            icon.attr('src', Url.imageUrl(img, 'filter_h5pdownload'));\n            return icon;\n        }\n    };\n});\n"],"file":"h5pdownload.min.js"}